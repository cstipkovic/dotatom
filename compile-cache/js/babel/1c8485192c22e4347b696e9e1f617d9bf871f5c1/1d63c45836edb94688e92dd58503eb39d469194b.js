var __vue_template__ = "<ol class=\"full-menu list-tree has-collapsable-children\" tabindex=\"-1\" v-on=\"mouseenter: hover, mouseleave: unhover\">\n    <div v-class=\"hidden: !isHovered\" class=\"save icon icon-bookmark\" v-on=\"click: save\">\n    </div>\n      <folder v-repeat=\"entry: filesTree\" track-by=\"path\">\n      </folder>\n    </ol>";
var addFileToTree, addFolderToTree, getElementFromTree, projectManager, sep, settings, sortByName, treeManager, wherePath;

wherePath = function (array, path) {
  var j, len, obj;
  for (j = 0, len = array.length; j < len; j++) {
    obj = array[j];
    if (obj.path === path) {
      return obj;
    }
  }
  return null;
};

sortByName = function (array) {
  return array.sort(function (a, b) {
    if (a.name < b.name) {
      return -1;
    }
    if (a.name > b.name) {
      return 1;
    }
    return 0;
  });
};

sep = null;

projectManager = null;

settings = null;

treeManager = null;

getElementFromTree = function (tree, path, sort, createElement) {
  var element;
  element = wherePath(tree, path);
  if (createElement != null) {
    if (element == null) {
      element = createElement();
      tree.push(element);
      if (sort) {
        sortByName(tree);
      }
    }
  }
  return [element, tree];
};

addFileToTree = function (tree, path, name) {
  var element, pathIdentifier, projectPaths, ref, result, sort, splittedPath;
  pathIdentifier = "";
  sort = true;
  if (name == null) {
    sort = false;
    result = atom.project.relativizePath(path);
    splittedPath = result[1].split(sep);
    name = splittedPath.pop();
    if (result[0] != null) {
      projectPaths = atom.project.getPaths();
      if (projectPaths.length > 1) {
        pathIdentifier += "" + (projectPaths.indexOf(result[0]) + 1);
        if (splittedPath.length > 0) {
          pathIdentifier += sep;
        }
      }
    }
    pathIdentifier += splittedPath.join(sep);
  }
  ref = getElementFromTree(tree, path, sort, function () {
    return {
      name: name,
      path: path,
      pathIdentifier: pathIdentifier
    };
  }), element = ref[0], tree = ref[1];
  return tree;
};

addFolderToTree = function (tree, splittedPath, index, path) {
  var calculatedPath, element, ref;
  calculatedPath = splittedPath.slice(0, index + 1).join("/");
  ref = getElementFromTree(tree, calculatedPath, true, function () {
    return {
      name: splittedPath[index],
      folders: [],
      files: [],
      path: calculatedPath
    };
  }), element = ref[0], tree = ref[1];
  if (splittedPath.length === index + 2) {
    element.files = addFileToTree(element.files, path, splittedPath[index + 1]);
  } else {
    element.folders = addFolderToTree(element.folders, splittedPath, index + 1, path);
  }
  return tree;
};

module.exports = {
  data: function data() {
    return {
      filesTree: [],
      colors: {},
      expanded: false,
      saving: false,
      savedSettings: [],
      isHovered: false
    };
  },
  methods: {
    hover: function hover(e) {
      return this.isHovered = true;
    },
    unhover: function unhover(e) {
      return this.isHovered = false;
    },
    addFile: function addFile(path) {
      var result, rootElement, rootName, splittedPath;
      this.log("adding " + path, 2);
      if (atom.config.get("opened-files.asList")) {
        rootElement = this.filesTree[0];
        if (rootElement == null) {
          rootElement = {
            name: "Opened files",
            path: "",
            folders: [],
            files: [],
            isRoot: true
          };
          this.filesTree.push(rootElement);
        }
        return rootElement.files = addFileToTree(rootElement.files, path);
      } else {
        result = atom.project.relativizePath(path);
        if ((result != null ? result[0] : void 0) != null) {
          rootName = result[0].split(sep).pop();
          rootElement = wherePath(this.filesTree, result[0]);
          if (rootElement == null) {
            rootElement = {
              name: rootName,
              path: result[0],
              folders: [],
              files: []
            };
            this.filesTree.push(rootElement);
            sortByName(this.filesTree);
          }
          splittedPath = result[1].split(sep);
          if (splittedPath.length === 1) {
            return rootElement.files = addFileToTree(rootElement.files, path, splittedPath[0]);
          } else {
            return rootElement.folders = addFolderToTree(rootElement.folders, splittedPath, 0, path);
          }
        }
      }
    },
    selected: function selected(path) {
      return this.$broadcast("selected", path);
    },
    resize: function resize() {
      return treeManager.autoHeight();
    },
    colorChangeCb: function colorChangeCb(path, color) {
      if (typeof this !== "undefined" && this !== null && this.colors != null) {
        this.log("colorChangeCb called", 2);
        this.colors[path] = color;
        return this.$broadcast("color", path);
      }
    },
    redraw: function redraw() {
      var j, len, path, results;
      this.filesTree = [];
      results = [];
      for (j = 0, len = settings.length; j < len; j++) {
        path = settings[j];
        results.push(this.addFile(path));
      }
      return results;
    },
    removePath: function removePath(path) {
      var i;
      i = settings.indexOf(path);
      if (i > -1) {
        return settings.splice(i, 1);
      }
    },
    save: function save() {
      if (this.saving === false) {
        this.saving = true;
        this.log("saving", 2);
        projectManager.addToProjectSetting(settings);
        this.savedSettings = settings.slice();
        return this.saving = false;
      } else {
        this.log("delaying save", 2);
        setTimeout((function (_this) {
          return function () {
            return _this.saving = false;
          };
        })(this), 90);
        return setTimeout(this.save, 100);
      }
    },
    closeUnsaved: function closeUnsaved() {
      var j, len, path, results;
      results = [];
      for (j = 0, len = settings.length; j < len; j++) {
        path = settings[j];
        if (this.savedSettings.indexOf(path) === -1) {
          results.push(this.$broadcast("close", path));
        } else {
          results.push(void 0);
        }
      }
      return results;
    }
  },
  beforeCompile: function beforeCompile() {
    sep = require("path").sep;
    if (projectManager == null) {
      projectManager = require("./../lib/project-manager");
    }
    if (treeManager == null) {
      treeManager = require("./../lib/tree-manager");
    }
    settings = projectManager.getProjectSetting();
    if (!Array.isArray(settings)) {
      settings = [];
    }
    this.savedSettings = settings.slice();
    return this.log("beforeCompile", 2);
  },
  created: function created() {
    return this.$on("removeFolder", (function (_this) {
      return function (entry) {
        _this.filesTree.$remove(entry);
        return false;
      };
    })(this));
  },
  compiled: function compiled() {
    var j, len, path;
    for (j = 0, len = settings.length; j < len; j++) {
      path = settings[j];
      this.addFile(path);
    }
    this.addDisposable(atom.workspace.observeTextEditors((function (_this) {
      return function (editor) {
        if ((editor != null ? editor.getPath : void 0) != null) {
          path = editor.getPath();
          if (path != null && settings.indexOf(path) === -1) {
            _this.addFile(path);
            return settings.push(path);
          }
        }
      };
    })(this)));
    this.addDisposable(atom.commands.add("atom-workspace", {
      "opened-files:close-all-but-saved": this.closeUnsaved
    }));
    this.addDisposable(atom.config.onDidChange("opened-files.asList", this.redraw));
    this.addDisposable(atom.config.onDidChange("opened-files.highlightOnHover", this.redraw));
    this.addDisposable(atom.config.onDidChange("opened-files.debug", this.redraw));
    this.addDisposable(atom.config.observe("opened-files.colorStyle", this.redraw));
    return this.log("compiled", 2);
  },
  ready: function ready() {
    return this.log("ready", 2);
  },
  attached: function attached() {
    return this.log("attached", 2);
  }
};

;(typeof module.exports === "function" ? module.exports.options : module.exports).template = __vue_template__;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2Npbl9jaGFsaWMvLmF0b20vcGFja2FnZXMvb3BlbmVkLWZpbGVzL2NvbXBvbmVudHNfY29tcGlsZWQvYXBwLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLElBQUksZ0JBQWdCLEdBQUcsc1VBQXNVLENBQUM7QUFDOVYsSUFBSSxhQUFhLEVBQUUsZUFBZSxFQUFFLGtCQUFrQixFQUFFLGNBQWMsRUFBRSxHQUFHLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRSxXQUFXLEVBQUUsU0FBUyxDQUFDOztBQUUxSCxTQUFTLEdBQUcsVUFBUyxLQUFLLEVBQUUsSUFBSSxFQUFFO0FBQ2hDLE1BQUksQ0FBQyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUM7QUFDaEIsT0FBSyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUU7QUFDNUMsT0FBRyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUNmLFFBQUksR0FBRyxDQUFDLElBQUksS0FBSyxJQUFJLEVBQUU7QUFDckIsYUFBTyxHQUFHLENBQUM7S0FDWjtHQUNGO0FBQ0QsU0FBTyxJQUFJLENBQUM7Q0FDYixDQUFDOztBQUVGLFVBQVUsR0FBRyxVQUFTLEtBQUssRUFBRTtBQUMzQixTQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsVUFBUyxDQUFDLEVBQUUsQ0FBQyxFQUFFO0FBQy9CLFFBQUksQ0FBQyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFO0FBQ25CLGFBQU8sQ0FBQyxDQUFDLENBQUM7S0FDWDtBQUNELFFBQUksQ0FBQyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFO0FBQ25CLGFBQU8sQ0FBQyxDQUFDO0tBQ1Y7QUFDRCxXQUFPLENBQUMsQ0FBQztHQUNWLENBQUMsQ0FBQztDQUNKLENBQUM7O0FBRUYsR0FBRyxHQUFHLElBQUksQ0FBQzs7QUFF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QyxDQUFDLENBQUM7QUFDaEYsV0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsQ0FBQztHQUNoQztBQUNELE9BQUssRUFBRSxpQkFBVztBQUNoQixXQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDO0dBQzdCO0FBQ0QsVUFBUSxFQUFFLG9CQUFXO0FBQ25CLFdBQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLENBQUM7R0FDaEM7Q0FDRixDQUFDOztBQUVGLENBQUMsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxPQUFPLEtBQUssVUFBVSxHQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsT0FBTyxHQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUEsQ0FBRSxRQUFRLEdBQUcsZ0JBQWdCLENBQUMiLCJmaWxlIjoiL2hvbWUvY2luX2NoYWxpYy8uYXRvbS9wYWNrYWdlcy9vcGVuZWQtZmlsZXMvY29tcG9uZW50c19jb21waWxlZC9hcHAuanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgX192dWVfdGVtcGxhdGVfXyA9IFwiPG9sIGNsYXNzPVxcXCJmdWxsLW1lbnUgbGlzdC10cmVlIGhhcy1jb2xsYXBzYWJsZS1jaGlsZHJlblxcXCIgdGFiaW5kZXg9XFxcIi0xXFxcIiB2LW9uPVxcXCJtb3VzZWVudGVyOiBob3ZlciwgbW91c2VsZWF2ZTogdW5ob3ZlclxcXCI+XFxuICAgIDxkaXYgdi1jbGFzcz1cXFwiaGlkZGVuOiAhaXNIb3ZlcmVkXFxcIiBjbGFzcz1cXFwic2F2ZSBpY29uIGljb24tYm9va21hcmtcXFwiIHYtb249XFxcImNsaWNrOiBzYXZlXFxcIj5cXG4gICAgPC9kaXY+XFxuICAgICAgPGZvbGRlciB2LXJlcGVhdD1cXFwiZW50cnk6IGZpbGVzVHJlZVxcXCIgdHJhY2stYnk9XFxcInBhdGhcXFwiPlxcbiAgICAgIDwvZm9sZGVyPlxcbiAgICA8L29sPlwiO1xudmFyIGFkZEZpbGVUb1RyZWUsIGFkZEZvbGRlclRvVHJlZSwgZ2V0RWxlbWVudEZyb21UcmVlLCBwcm9qZWN0TWFuYWdlciwgc2VwLCBzZXR0aW5ncywgc29ydEJ5TmFtZSwgdHJlZU1hbmFnZXIsIHdoZXJlUGF0aDtcblxud2hlcmVQYXRoID0gZnVuY3Rpb24oYXJyYXksIHBhdGgpIHtcbiAgdmFyIGosIGxlbiwgb2JqO1xuICBmb3IgKGogPSAwLCBsZW4gPSBhcnJheS5sZW5ndGg7IGogPCBsZW47IGorKykge1xuICAgIG9iaiA9IGFycmF5W2pdO1xuICAgIGlmIChvYmoucGF0aCA9PT0gcGF0aCkge1xuICAgICAgcmV0dXJuIG9iajtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59O1xuXG5zb3J0QnlOYW1lID0gZnVuY3Rpb24oYXJyYXkpIHtcbiAgcmV0dXJuIGFycmF5LnNvcnQoZnVuY3Rpb24oYSwgYikge1xuICAgIGlmIChhLm5hbWUgPCBiLm5hbWUpIHtcbiAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gICAgaWYgKGEubmFtZSA+IGIubmFtZSkge1xuICAgICAgcmV0dXJuIDE7XG4gICAgfVxuICAgIHJldHVybiAwO1xuICB9KTtcbn07XG5cbnNlcCA9IG51bGw7XG5cbnByb2plY3RNYW5hZ2VyID0gbnVsbDtcblxuc2V0dGluZ3MgPSBudWxsO1xuXG50cmVlTWFuYWdlciA9IG51bGw7XG5cbmdldEVsZW1lbnRGcm9tVHJlZSA9IGZ1bmN0aW9uKHRyZWUsIHBhdGgsIHNvcnQsIGNyZWF0ZUVsZW1lbnQpIHtcbiAgdmFyIGVsZW1lbnQ7XG4gIGVsZW1lbnQgPSB3aGVyZVBhdGgodHJlZSwgcGF0aCk7XG4gIGlmIChjcmVhdGVFbGVtZW50ICE9IG51bGwpIHtcbiAgICBpZiAoZWxlbWVudCA9PSBudWxsKSB7XG4gICAgICBlbGVtZW50ID0gY3JlYXRlRWxlbWVudCgpO1xuICAgICAgdHJlZS5wdXNoKGVsZW1lbnQpO1xuICAgICAgaWYgKHNvcnQpIHtcbiAgICAgICAgc29ydEJ5TmFtZSh0cmVlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIFtlbGVtZW50LCB0cmVlXTtcbn07XG5cbmFkZEZpbGVUb1RyZWUgPSBmdW5jdGlvbih0cmVlLCBwYXRoLCBuYW1lKSB7XG4gIHZhciBlbGVtZW50LCBwYXRoSWRlbnRpZmllciwgcHJvamVjdFBhdGhzLCByZWYsIHJlc3VsdCwgc29ydCwgc3BsaXR0ZWRQYXRoO1xuICBwYXRoSWRlbnRpZmllciA9IFwiXCI7XG4gIHNvcnQgPSB0cnVlO1xuICBpZiAobmFtZSA9PSBudWxsKSB7XG4gICAgc29ydCA9IGZhbHNlO1xuICAgIHJlc3VsdCA9IGF0b20ucHJvamVjdC5yZWxhdGl2aXplUGF0aChwYXRoKTtcbiAgICBzcGxpdHRlZFBhdGggPSByZXN1bHRbMV0uc3BsaXQoc2VwKTtcbiAgICBuYW1lID0gc3BsaXR0ZWRQYXRoLnBvcCgpO1xuICAgIGlmIChyZXN1bHRbMF0gIT0gbnVsbCkge1xuICAgICAgcHJvamVjdFBhdGhzID0gYXRvbS5wcm9qZWN0LmdldFBhdGhzKCk7XG4gICAgICBpZiAocHJvamVjdFBhdGhzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgcGF0aElkZW50aWZpZXIgKz0gXCJcIiArIChwcm9qZWN0UGF0aHMuaW5kZXhPZihyZXN1bHRbMF0pICsgMSk7XG4gICAgICAgIGlmIChzcGxpdHRlZFBhdGgubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHBhdGhJZGVudGlmaWVyICs9IHNlcDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBwYXRoSWRlbnRpZmllciArPSBzcGxpdHRlZFBhdGguam9pbihzZXApO1xuICB9XG4gIHJlZiA9IGdldEVsZW1lbnRGcm9tVHJlZSh0cmVlLCBwYXRoLCBzb3J0LCBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogbmFtZSxcbiAgICAgIHBhdGg6IHBhdGgsXG4gICAgICBwYXRoSWRlbnRpZmllcjogcGF0aElkZW50aWZpZXJcbiAgICB9O1xuICB9KSwgZWxlbWVudCA9IHJlZlswXSwgdHJlZSA9IHJlZlsxXTtcbiAgcmV0dXJuIHRyZWU7XG59O1xuXG5hZGRGb2xkZXJUb1RyZWUgPSBmdW5jdGlvbih0cmVlLCBzcGxpdHRlZFBhdGgsIGluZGV4LCBwYXRoKSB7XG4gIHZhciBjYWxjdWxhdGVkUGF0aCwgZWxlbWVudCwgcmVmO1xuICBjYWxjdWxhdGVkUGF0aCA9IHNwbGl0dGVkUGF0aC5zbGljZSgwLCBpbmRleCArIDEpLmpvaW4oXCIvXCIpO1xuICByZWYgPSBnZXRFbGVtZW50RnJvbVRyZWUodHJlZSwgY2FsY3VsYXRlZFBhdGgsIHRydWUsIGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiBzcGxpdHRlZFBhdGhbaW5kZXhdLFxuICAgICAgZm9sZGVyczogW10sXG4gICAgICBmaWxlczogW10sXG4gICAgICBwYXRoOiBjYWxjdWxhdGVkUGF0aFxuICAgIH07XG4gIH0pLCBlbGVtZW50ID0gcmVmWzBdLCB0cmVlID0gcmVmWzFdO1xuICBpZiAoc3BsaXR0ZWRQYXRoLmxlbmd0aCA9PT0gaW5kZXggKyAyKSB7XG4gICAgZWxlbWVudC5maWxlcyA9IGFkZEZpbGVUb1RyZWUoZWxlbWVudC5maWxlcywgcGF0aCwgc3BsaXR0ZWRQYXRoW2luZGV4ICsgMV0pO1xuICB9IGVsc2Uge1xuICAgIGVsZW1lbnQuZm9sZGVycyA9IGFkZEZvbGRlclRvVHJlZShlbGVtZW50LmZvbGRlcnMsIHNwbGl0dGVkUGF0aCwgaW5kZXggKyAxLCBwYXRoKTtcbiAgfVxuICByZXR1cm4gdHJlZTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBkYXRhOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4ge1xuICAgICAgZmlsZXNUcmVlOiBbXSxcbiAgICAgIGNvbG9yczoge30sXG4gICAgICBleHBhbmRlZDogZmFsc2UsXG4gICAgICBzYXZpbmc6IGZhbHNlLFxuICAgICAgc2F2ZWRTZXR0aW5nczogW10sXG4gICAgICBpc0hvdmVyZWQ6IGZhbHNlXG4gICAgfTtcbiAgfSxcbiAgbWV0aG9kczoge1xuICAgIGhvdmVyOiBmdW5jdGlvbihlKSB7XG4gICAgICByZXR1cm4gdGhpcy5pc0hvdmVyZWQgPSB0cnVlO1xuICAgIH0sXG4gICAgdW5ob3ZlcjogZnVuY3Rpb24oZSkge1xuICAgICAgcmV0dXJuIHRoaXMuaXNIb3ZlcmVkID0gZmFsc2U7XG4gICAgfSxcbiAgICBhZGRGaWxlOiBmdW5jdGlvbihwYXRoKSB7XG4gICAgICB2YXIgcmVzdWx0LCByb290RWxlbWVudCwgcm9vdE5hbWUsIHNwbGl0dGVkUGF0aDtcbiAgICAgIHRoaXMubG9nKFwiYWRkaW5nIFwiICsgcGF0aCwgMik7XG4gICAgICBpZiAoYXRvbS5jb25maWcuZ2V0KFwib3BlbmVkLWZpbGVzLmFzTGlzdFwiKSkge1xuICAgICAgICByb290RWxlbWVudCA9IHRoaXMuZmlsZXNUcmVlWzBdO1xuICAgICAgICBpZiAocm9vdEVsZW1lbnQgPT0gbnVsbCkge1xuICAgICAgICAgIHJvb3RFbGVtZW50ID0ge1xuICAgICAgICAgICAgbmFtZTogXCJPcGVuZWQgZmlsZXNcIixcbiAgICAgICAgICAgIHBhdGg6IFwiXCIsXG4gICAgICAgICAgICBmb2xkZXJzOiBbXSxcbiAgICAgICAgICAgIGZpbGVzOiBbXSxcbiAgICAgICAgICAgIGlzUm9vdDogdHJ1ZVxuICAgICAgICAgIH07XG4gICAgICAgICAgdGhpcy5maWxlc1RyZWUucHVzaChyb290RWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJvb3RFbGVtZW50LmZpbGVzID0gYWRkRmlsZVRvVHJlZShyb290RWxlbWVudC5maWxlcywgcGF0aCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXN1bHQgPSBhdG9tLnByb2plY3QucmVsYXRpdml6ZVBhdGgocGF0aCk7XG4gICAgICAgIGlmICgocmVzdWx0ICE9IG51bGwgPyByZXN1bHRbMF0gOiB2b2lkIDApICE9IG51bGwpIHtcbiAgICAgICAgICByb290TmFtZSA9IHJlc3VsdFswXS5zcGxpdChzZXApLnBvcCgpO1xuICAgICAgICAgIHJvb3RFbGVtZW50ID0gd2hlcmVQYXRoKHRoaXMuZmlsZXNUcmVlLCByZXN1bHRbMF0pO1xuICAgICAgICAgIGlmIChyb290RWxlbWVudCA9PSBudWxsKSB7XG4gICAgICAgICAgICByb290RWxlbWVudCA9IHtcbiAgICAgICAgICAgICAgbmFtZTogcm9vdE5hbWUsXG4gICAgICAgICAgICAgIHBhdGg6IHJlc3VsdFswXSxcbiAgICAgICAgICAgICAgZm9sZGVyczogW10sXG4gICAgICAgICAgICAgIGZpbGVzOiBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMuZmlsZXNUcmVlLnB1c2gocm9vdEVsZW1lbnQpO1xuICAgICAgICAgICAgc29ydEJ5TmFtZSh0aGlzLmZpbGVzVHJlZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHNwbGl0dGVkUGF0aCA9IHJlc3VsdFsxXS5zcGxpdChzZXApO1xuICAgICAgICAgIGlmIChzcGxpdHRlZFBhdGgubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICByZXR1cm4gcm9vdEVsZW1lbnQuZmlsZXMgPSBhZGRGaWxlVG9UcmVlKHJvb3RFbGVtZW50LmZpbGVzLCBwYXRoLCBzcGxpdHRlZFBhdGhbMF0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gcm9vdEVsZW1lbnQuZm9sZGVycyA9IGFkZEZvbGRlclRvVHJlZShyb290RWxlbWVudC5mb2xkZXJzLCBzcGxpdHRlZFBhdGgsIDAsIHBhdGgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgc2VsZWN0ZWQ6IGZ1bmN0aW9uKHBhdGgpIHtcbiAgICAgIHJldHVybiB0aGlzLiRicm9hZGNhc3QoXCJzZWxlY3RlZFwiLCBwYXRoKTtcbiAgICB9LFxuICAgIHJlc2l6ZTogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdHJlZU1hbmFnZXIuYXV0b0hlaWdodCgpO1xuICAgIH0sXG4gICAgY29sb3JDaGFuZ2VDYjogZnVuY3Rpb24ocGF0aCwgY29sb3IpIHtcbiAgICAgIGlmICgodHlwZW9mIHRoaXMgIT09IFwidW5kZWZpbmVkXCIgJiYgdGhpcyAhPT0gbnVsbCkgJiYgKHRoaXMuY29sb3JzICE9IG51bGwpKSB7XG4gICAgICAgIHRoaXMubG9nKFwiY29sb3JDaGFuZ2VDYiBjYWxsZWRcIiwgMik7XG4gICAgICAgIHRoaXMuY29sb3JzW3BhdGhdID0gY29sb3I7XG4gICAgICAgIHJldHVybiB0aGlzLiRicm9hZGNhc3QoXCJjb2xvclwiLCBwYXRoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHJlZHJhdzogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgaiwgbGVuLCBwYXRoLCByZXN1bHRzO1xuICAgICAgdGhpcy5maWxlc1RyZWUgPSBbXTtcbiAgICAgIHJlc3VsdHMgPSBbXTtcbiAgICAgIGZvciAoaiA9IDAsIGxlbiA9IHNldHRpbmdzLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICAgIHBhdGggPSBzZXR0aW5nc1tqXTtcbiAgICAgICAgcmVzdWx0cy5wdXNoKHRoaXMuYWRkRmlsZShwYXRoKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9LFxuICAgIHJlbW92ZVBhdGg6IGZ1bmN0aW9uKHBhdGgpIHtcbiAgICAgIHZhciBpO1xuICAgICAgaSA9IHNldHRpbmdzLmluZGV4T2YocGF0aCk7XG4gICAgICBpZiAoaSA+IC0xKSB7XG4gICAgICAgIHJldHVybiBzZXR0aW5ncy5zcGxpY2UoaSwgMSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBzYXZlOiBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0aGlzLnNhdmluZyA9PT0gZmFsc2UpIHtcbiAgICAgICAgdGhpcy5zYXZpbmcgPSB0cnVlO1xuICAgICAgICB0aGlzLmxvZyhcInNhdmluZ1wiLCAyKTtcbiAgICAgICAgcHJvamVjdE1hbmFnZXIuYWRkVG9Qcm9qZWN0U2V0dGluZyhzZXR0aW5ncyk7XG4gICAgICAgIHRoaXMuc2F2ZWRTZXR0aW5ncyA9IHNldHRpbmdzLnNsaWNlKCk7XG4gICAgICAgIHJldHVybiB0aGlzLnNhdmluZyA9IGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5sb2coXCJkZWxheWluZyBzYXZlXCIsIDIpO1xuICAgICAgICBzZXRUaW1lb3V0KCgoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuc2F2aW5nID0gZmFsc2U7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSkodGhpcykpLCA5MCk7XG4gICAgICAgIHJldHVybiBzZXRUaW1lb3V0KHRoaXMuc2F2ZSwgMTAwKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGNsb3NlVW5zYXZlZDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgaiwgbGVuLCBwYXRoLCByZXN1bHRzO1xuICAgICAgcmVzdWx0cyA9IFtdO1xuICAgICAgZm9yIChqID0gMCwgbGVuID0gc2V0dGluZ3MubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgICAgcGF0aCA9IHNldHRpbmdzW2pdO1xuICAgICAgICBpZiAodGhpcy5zYXZlZFNldHRpbmdzLmluZGV4T2YocGF0aCkgPT09IC0xKSB7XG4gICAgICAgICAgcmVzdWx0cy5wdXNoKHRoaXMuJGJyb2FkY2FzdChcImNsb3NlXCIsIHBhdGgpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXN1bHRzLnB1c2godm9pZCAwKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfVxuICB9LFxuICBiZWZvcmVDb21waWxlOiBmdW5jdGlvbigpIHtcbiAgICBzZXAgPSByZXF1aXJlKFwicGF0aFwiKS5zZXA7XG4gICAgaWYgKHByb2plY3RNYW5hZ2VyID09IG51bGwpIHtcbiAgICAgIHByb2plY3RNYW5hZ2VyID0gcmVxdWlyZShcIi4vLi4vbGliL3Byb2plY3QtbWFuYWdlclwiKTtcbiAgICB9XG4gICAgaWYgKHRyZWVNYW5hZ2VyID09IG51bGwpIHtcbiAgICAgIHRyZWVNYW5hZ2VyID0gcmVxdWlyZShcIi4vLi4vbGliL3RyZWUtbWFuYWdlclwiKTtcbiAgICB9XG4gICAgc2V0dGluZ3MgPSBwcm9qZWN0TWFuYWdlci5nZXRQcm9qZWN0U2V0dGluZygpO1xuICAgIGlmICghQXJyYXkuaXNBcnJheShzZXR0aW5ncykpIHtcbiAgICAgIHNldHRpbmdzID0gW107XG4gICAgfVxuICAgIHRoaXMuc2F2ZWRTZXR0aW5ncyA9IHNldHRpbmdzLnNsaWNlKCk7XG4gICAgcmV0dXJuIHRoaXMubG9nKFwiYmVmb3JlQ29tcGlsZVwiLCAyKTtcbiAgfSxcbiAgY3JlYXRlZDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuJG9uKFwicmVtb3ZlRm9sZGVyXCIsIChmdW5jdGlvbihfdGhpcykge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKGVudHJ5KSB7XG4gICAgICAgIF90aGlzLmZpbGVzVHJlZS4kcmVtb3ZlKGVudHJ5KTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfTtcbiAgICB9KSh0aGlzKSk7XG4gIH0sXG4gIGNvbXBpbGVkOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgaiwgbGVuLCBwYXRoO1xuICAgIGZvciAoaiA9IDAsIGxlbiA9IHNldHRpbmdzLmxlbmd0aDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICBwYXRoID0gc2V0dGluZ3Nbal07XG4gICAgICB0aGlzLmFkZEZpbGUocGF0aCk7XG4gICAgfVxuICAgIHRoaXMuYWRkRGlzcG9zYWJsZShhdG9tLndvcmtzcGFjZS5vYnNlcnZlVGV4dEVkaXRvcnMoKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24oZWRpdG9yKSB7XG4gICAgICAgIGlmICgoZWRpdG9yICE9IG51bGwgPyBlZGl0b3IuZ2V0UGF0aCA6IHZvaWQgMCkgIT0gbnVsbCkge1xuICAgICAgICAgIHBhdGggPSBlZGl0b3IuZ2V0UGF0aCgpO1xuICAgICAgICAgIGlmICgocGF0aCAhPSBudWxsKSAmJiBzZXR0aW5ncy5pbmRleE9mKHBhdGgpID09PSAtMSkge1xuICAgICAgICAgICAgX3RoaXMuYWRkRmlsZShwYXRoKTtcbiAgICAgICAgICAgIHJldHVybiBzZXR0aW5ncy5wdXNoKHBhdGgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9KSh0aGlzKSkpO1xuICAgIHRoaXMuYWRkRGlzcG9zYWJsZShhdG9tLmNvbW1hbmRzLmFkZCgnYXRvbS13b3Jrc3BhY2UnLCB7XG4gICAgICAnb3BlbmVkLWZpbGVzOmNsb3NlLWFsbC1idXQtc2F2ZWQnOiB0aGlzLmNsb3NlVW5zYXZlZFxuICAgIH0pKTtcbiAgICB0aGlzLmFkZERpc3Bvc2FibGUoYXRvbS5jb25maWcub25EaWRDaGFuZ2UoJ29wZW5lZC1maWxlcy5hc0xpc3QnLCB0aGlzLnJlZHJhdykpO1xuICAgIHRoaXMuYWRkRGlzcG9zYWJsZShhdG9tLmNvbmZpZy5vbkRpZENoYW5nZSgnb3BlbmVkLWZpbGVzLmhpZ2hsaWdodE9uSG92ZXInLCB0aGlzLnJlZHJhdykpO1xuICAgIHRoaXMuYWRkRGlzcG9zYWJsZShhdG9tLmNvbmZpZy5vbkRpZENoYW5nZSgnb3BlbmVkLWZpbGVzLmRlYnVnJywgdGhpcy5yZWRyYXcpKTtcbiAgICB0aGlzLmFkZERpc3Bvc2FibGUoYXRvbS5jb25maWcub2JzZXJ2ZSgnb3BlbmVkLWZpbGVzLmNvbG9yU3R5bGUnLCB0aGlzLnJlZHJhdykpO1xuICAgIHJldHVybiB0aGlzLmxvZyhcImNvbXBpbGVkXCIsIDIpO1xuICB9LFxuICByZWFkeTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMubG9nKFwicmVhZHlcIiwgMik7XG4gIH0sXG4gIGF0dGFjaGVkOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5sb2coXCJhdHRhY2hlZFwiLCAyKTtcbiAgfVxufTtcblxuOyh0eXBlb2YgbW9kdWxlLmV4cG9ydHMgPT09IFwiZnVuY3Rpb25cIj8gbW9kdWxlLmV4cG9ydHMub3B0aW9uczogbW9kdWxlLmV4cG9ydHMpLnRlbXBsYXRlID0gX192dWVfdGVtcGxhdGVfXztcbiJdfQ==