function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

require('./spec-bootstrap');

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _libMasterTexFinder = require('../lib/master-tex-finder');

var _libMasterTexFinder2 = _interopRequireDefault(_libMasterTexFinder);

'use babel';

describe('MasterTexFinder', function () {
  var rootPath = undefined,
      fixturesPath = undefined;

  beforeEach(function () {
    rootPath = atom.project.getPaths()[0];
    fixturesPath = _path2['default'].join(rootPath, 'master-tex-finder', 'single-master');

    atom.config.set('latex.useMasterFileSearch', true);
  });

  describe('getMasterTexPath', function () {
    it('returns the master tex file for the current project', function () {
      var inc2Path = _path2['default'].join(fixturesPath, 'inc2.tex');
      var finder = new _libMasterTexFinder2['default'](inc2Path);

      expect(finder.getMasterTexPath()).toBe(_path2['default'].join(fixturesPath, 'master.tex'));
    });

    it('immediately return the given file, if itself is a root-file', function () {
      var masterFile = _path2['default'].join(fixturesPath, 'master.tex');
      var finder = new _libMasterTexFinder2['default'](masterFile);
      spyOn(finder, 'getTexFilesList').andCallThrough();

      expect(finder.getMasterTexPath()).toBe(masterFile);
      expect(finder.getTexFilesList).not.toHaveBeenCalled();
    });

    it('returns the original file if more than one file is a master file', function () {
      var multiMasterFixturePath = _path2['default'].join(rootPath, 'master-tex-finder', 'multiple-masters');
      var inc1Path = _path2['default'].join(multiMasterFixturePath, 'inc1.tex');
      var finder = new _libMasterTexFinder2['default'](inc1Path);

      expect(finder.getMasterTexPath()).toBe(inc1Path);
    });

    it('immediately returns the file specified by the magic comment when present', function () {
      var inc1Path = _path2['default'].join(fixturesPath, 'inc1.tex');
      var finder = new _libMasterTexFinder2['default'](inc1Path);

      spyOn(finder, 'getTexFilesList').andCallThrough();

      expect(finder.getMasterTexPath()).toBe(_path2['default'].join(fixturesPath, 'master.tex'));
      expect(finder.getTexFilesList).not.toHaveBeenCalled();
    });

    it('returns the original file if the heuristic search feature is disabled', function () {
      var inc2Path = _path2['default'].join(fixturesPath, 'inc2.tex');
      var finder = new _libMasterTexFinder2['default'](inc2Path);

      atom.config.set('latex.useMasterFileSearch', false);
      spyOn(finder, 'isMasterFile').andCallThrough();
      spyOn(finder, 'searchForMasterFile').andCallThrough();

      expect(finder.getMasterTexPath()).toBe(inc2Path);
      expect(finder.isMasterFile).not.toHaveBeenCalled();
      expect(finder.searchForMasterFile).not.toHaveBeenCalled();
    });
  });

  describe('isMasterFile', function () {
    it('returns true if the given file is the master file', function () {
      var masterFilePath = _path2['default'].join(fixturesPath, 'master.tex');
      var inc2Path = _path2['default'].join(fixturesPath, 'inc2.tex');
      var finder = new _libMasterTexFinder2['default'](inc2Path);

      expect(finder.isMasterFile(masterFilePath)).toBe(true);
    });
  });

  describe('getTexFilesList', function () {
    it('returns the list of tex files in the project directory', function () {
      var expectedFileList = ['inc1.tex', 'inc2.tex', 'inc3.tex', 'master.tex'].map(function (name) {
        return _path2['default'].join(fixturesPath, name);
      });
      var inc2Path = _path2['default'].join(fixturesPath, 'inc2.tex');
      var finder = new _libMasterTexFinder2['default'](inc2Path);
      var sortedFileList = finder.getTexFilesList().sort();

      expect(sortedFileList).toEqual(expectedFileList);
    });
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2Npbl9jaGFsaWMvLmF0b20vcGFja2FnZXMvbGF0ZXgvc3BlYy9tYXN0ZXItdGV4LWZpbmRlci1zcGVjLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O1FBRU8sa0JBQWtCOztvQkFDUixNQUFNOzs7O2tDQUNLLDBCQUEwQjs7OztBQUp0RCxXQUFXLENBQUE7O0FBTVgsUUFBUSxDQUFDLGlCQUFpQixFQUFFLFlBQU07QUFDaEMsTUFBSSxRQUFRLFlBQUE7TUFBRSxZQUFZLFlBQUEsQ0FBQTs7QUFFMUIsWUFBVSxDQUFDLFlBQU07QUFDZixZQUFRLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUNyQyxnQkFBWSxHQUFHLGtCQUFLLElBQUksQ0FBQyxRQUFRLEVBQUUsbUJBQW1CLEVBQUUsZUFBZSxDQUFDLENBQUE7O0FBRXhFLFFBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLDJCQUEyQixFQUFFLElBQUksQ0FBQyxDQUFBO0dBQ25ELENBQUMsQ0FBQTs7QUFFRixVQUFRLENBQUMsa0JBQWtCLEVBQUUsWUFBTTtBQUNqQyxNQUFFLENBQUMscURBQXFELEVBQUUsWUFBTTtBQUM5RCxVQUFNLFFBQVEsR0FBRyxrQkFBSyxJQUFJLENBQUMsWUFBWSxFQUFFLFVBQVUsQ0FBQyxDQUFBO0FBQ3BELFVBQU0sTUFBTSxHQUFHLG9DQUFvQixRQUFRLENBQUMsQ0FBQTs7QUFFNUMsWUFBTSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGtCQUFLLElBQUksQ0FBQyxZQUFZLEVBQUUsWUFBWSxDQUFDLENBQUMsQ0FBQTtLQUM5RSxDQUFDLENBQUE7O0FBRUYsTUFBRSxDQUFDLDZEQUE2RCxFQUFFLFlBQU07QUFDdEUsVUFBTSxVQUFVLEdBQUcsa0JBQUssSUFBSSxDQUFDLFlBQVksRUFBRSxZQUFZLENBQUMsQ0FBQTtBQUN4RCxVQUFNLE1BQU0sR0FBRyxv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QUE7S0FDdkQsQ0FBQyxDQUFBO0dBQ0gsQ0FBQyxDQUFBOztBQUVGLFVBQVEsQ0FBQyxpQkFBaUIsRUFBRSxZQUFNO0FBQ2hDLE1BQUUsQ0FBQyx3REFBd0QsRUFBRSxZQUFNO0FBQ2pFLFVBQU0sZ0JBQWdCLEdBQUcsQ0FBQyxVQUFVLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxZQUFZLENBQUMsQ0FDeEUsR0FBRyxDQUFDLFVBQUEsSUFBSTtlQUFJLGtCQUFLLElBQUksQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDO09BQUEsQ0FBQyxDQUFBO0FBQzdDLFVBQU0sUUFBUSxHQUFHLGtCQUFLLElBQUksQ0FBQyxZQUFZLEVBQUUsVUFBVSxDQUFDLENBQUE7QUFDcEQsVUFBTSxNQUFNLEdBQUcsb0NBQW9CLFFBQVEsQ0FBQyxDQUFBO0FBQzVDLFVBQU0sY0FBYyxHQUFHLE1BQU0sQ0FBQyxlQUFlLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQTs7QUFFdEQsWUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFBO0tBQ2pELENBQUMsQ0FBQTtHQUNILENBQUMsQ0FBQTtDQUNILENBQUMsQ0FBQSIsImZpbGUiOiIvaG9tZS9jaW5fY2hhbGljLy5hdG9tL3BhY2thZ2VzL2xhdGV4L3NwZWMvbWFzdGVyLXRleC1maW5kZXItc3BlYy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2UgYmFiZWwnXG5cbmltcG9ydCAnLi9zcGVjLWJvb3RzdHJhcCdcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnXG5pbXBvcnQgTWFzdGVyVGV4RmluZGVyIGZyb20gJy4uL2xpYi9tYXN0ZXItdGV4LWZpbmRlcidcblxuZGVzY3JpYmUoJ01hc3RlclRleEZpbmRlcicsICgpID0+IHtcbiAgbGV0IHJvb3RQYXRoLCBmaXh0dXJlc1BhdGhcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICByb290UGF0aCA9IGF0b20ucHJvamVjdC5nZXRQYXRocygpWzBdXG4gICAgZml4dHVyZXNQYXRoID0gcGF0aC5qb2luKHJvb3RQYXRoLCAnbWFzdGVyLXRleC1maW5kZXInLCAnc2luZ2xlLW1hc3RlcicpXG5cbiAgICBhdG9tLmNvbmZpZy5zZXQoJ2xhdGV4LnVzZU1hc3RlckZpbGVTZWFyY2gnLCB0cnVlKVxuICB9KVxuXG4gIGRlc2NyaWJlKCdnZXRNYXN0ZXJUZXhQYXRoJywgKCkgPT4ge1xuICAgIGl0KCdyZXR1cm5zIHRoZSBtYXN0ZXIgdGV4IGZpbGUgZm9yIHRoZSBjdXJyZW50IHByb2plY3QnLCAoKSA9PiB7XG4gICAgICBjb25zdCBpbmMyUGF0aCA9IHBhdGguam9pbihmaXh0dXJlc1BhdGgsICdpbmMyLnRleCcpXG4gICAgICBjb25zdCBmaW5kZXIgPSBuZXcgTWFzdGVyVGV4RmluZGVyKGluYzJQYXRoKVxuXG4gICAgICBleHBlY3QoZmluZGVyLmdldE1hc3RlclRleFBhdGgoKSkudG9CZShwYXRoLmpvaW4oZml4dHVyZXNQYXRoLCAnbWFzdGVyLnRleCcpKVxuICAgIH0pXG5cbiAgICBpdCgnaW1tZWRpYXRlbHkgcmV0dXJuIHRoZSBnaXZlbiBmaWxlLCBpZiBpdHNlbGYgaXMgYSByb290LWZpbGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtYXN0ZXJGaWxlID0gcGF0aC5qb2luKGZpeHR1cmVzUGF0aCwgJ21hc3Rlci50ZXgnKVxuICAgICAgY29uc3QgZmluZGVyID0gbmV3IE1hc3RlclRleEZpbmRlcihtYXN0ZXJGaWxlKVxuICAgICAgc3B5T24oZmluZGVyLCAnZ2V0VGV4RmlsZXNMaXN0JykuYW5kQ2FsbFRocm91Z2goKVxuXG4gICAgICBleHBlY3QoZmluZGVyLmdldE1hc3RlclRleFBhdGgoKSkudG9CZShtYXN0ZXJGaWxlKVxuICAgICAgZXhwZWN0KGZpbmRlci5nZXRUZXhGaWxlc0xpc3QpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKClcbiAgICB9KVxuXG4gICAgaXQoJ3JldHVybnMgdGhlIG9yaWdpbmFsIGZpbGUgaWYgbW9yZSB0aGFuIG9uZSBmaWxlIGlzIGEgbWFzdGVyIGZpbGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtdWx0aU1hc3RlckZpeHR1cmVQYXRoID0gcGF0aC5qb2luKHJvb3RQYXRoLCAnbWFzdGVyLXRleC1maW5kZXInLCAnbXVsdGlwbGUtbWFzdGVycycpXG4gICAgICBjb25zdCBpbmMxUGF0aCA9IHBhdGguam9pbihtdWx0aU1hc3RlckZpeHR1cmVQYXRoLCAnaW5jMS50ZXgnKVxuICAgICAgY29uc3QgZmluZGVyID0gbmV3IE1hc3RlclRleEZpbmRlcihpbmMxUGF0aClcblxuICAgICAgZXhwZWN0KGZpbmRlci5nZXRNYXN0ZXJUZXhQYXRoKCkpLnRvQmUoaW5jMVBhdGgpXG4gICAgfSlcblxuICAgIGl0KCdpbW1lZGlhdGVseSByZXR1cm5zIHRoZSBmaWxlIHNwZWNpZmllZCBieSB0aGUgbWFnaWMgY29tbWVudCB3aGVuIHByZXNlbnQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBpbmMxUGF0aCA9IHBhdGguam9pbihmaXh0dXJlc1BhdGgsICdpbmMxLnRleCcpXG4gICAgICBjb25zdCBmaW5kZXIgPSBuZXcgTWFzdGVyVGV4RmluZGVyKGluYzFQYXRoKVxuXG4gICAgICBzcHlPbihmaW5kZXIsICdnZXRUZXhGaWxlc0xpc3QnKS5hbmRDYWxsVGhyb3VnaCgpXG5cbiAgICAgIGV4cGVjdChmaW5kZXIuZ2V0TWFzdGVyVGV4UGF0aCgpKS50b0JlKHBhdGguam9pbihmaXh0dXJlc1BhdGgsICdtYXN0ZXIudGV4JykpXG4gICAgICBleHBlY3QoZmluZGVyLmdldFRleEZpbGVzTGlzdCkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKVxuICAgIH0pXG5cbiAgICBpdCgncmV0dXJucyB0aGUgb3JpZ2luYWwgZmlsZSBpZiB0aGUgaGV1cmlzdGljIHNlYXJjaCBmZWF0dXJlIGlzIGRpc2FibGVkJywgKCkgPT4ge1xuICAgICAgY29uc3QgaW5jMlBhdGggPSBwYXRoLmpvaW4oZml4dHVyZXNQYXRoLCAnaW5jMi50ZXgnKVxuICAgICAgY29uc3QgZmluZGVyID0gbmV3IE1hc3RlclRleEZpbmRlcihpbmMyUGF0aClcblxuICAgICAgYXRvbS5jb25maWcuc2V0KCdsYXRleC51c2VNYXN0ZXJGaWxlU2VhcmNoJywgZmFsc2UpXG4gICAgICBzcHlPbihmaW5kZXIsICdpc01hc3RlckZpbGUnKS5hbmRDYWxsVGhyb3VnaCgpXG4gICAgICBzcHlPbihmaW5kZXIsICdzZWFyY2hGb3JNYXN0ZXJGaWxlJykuYW5kQ2FsbFRocm91Z2goKVxuXG4gICAgICBleHBlY3QoZmluZGVyLmdldE1hc3RlclRleFBhdGgoKSkudG9CZShpbmMyUGF0aClcbiAgICAgIGV4cGVjdChmaW5kZXIuaXNNYXN0ZXJGaWxlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpXG4gICAgICBleHBlY3QoZmluZGVyLnNlYXJjaEZvck1hc3RlckZpbGUpLm5vdC50b0hhdmVCZWVuQ2FsbGVkKClcbiAgICB9KVxuICB9KVxuXG4gIGRlc2NyaWJlKCdpc01hc3RlckZpbGUnLCAoKSA9PiB7XG4gICAgaXQoJ3JldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gZmlsZSBpcyB0aGUgbWFzdGVyIGZpbGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtYXN0ZXJGaWxlUGF0aCA9IHBhdGguam9pbihmaXh0dXJlc1BhdGgsICdtYXN0ZXIudGV4JylcbiAgICAgIGNvbnN0IGluYzJQYXRoID0gcGF0aC5qb2luKGZpeHR1cmVzUGF0aCwgJ2luYzIudGV4JylcbiAgICAgIGNvbnN0IGZpbmRlciA9IG5ldyBNYXN0ZXJUZXhGaW5kZXIoaW5jMlBhdGgpXG5cbiAgICAgIGV4cGVjdChmaW5kZXIuaXNNYXN0ZXJGaWxlKG1hc3RlckZpbGVQYXRoKSkudG9CZSh0cnVlKVxuICAgIH0pXG4gIH0pXG5cbiAgZGVzY3JpYmUoJ2dldFRleEZpbGVzTGlzdCcsICgpID0+IHtcbiAgICBpdCgncmV0dXJucyB0aGUgbGlzdCBvZiB0ZXggZmlsZXMgaW4gdGhlIHByb2plY3QgZGlyZWN0b3J5JywgKCkgPT4ge1xuICAgICAgY29uc3QgZXhwZWN0ZWRGaWxlTGlzdCA9IFsnaW5jMS50ZXgnLCAnaW5jMi50ZXgnLCAnaW5jMy50ZXgnLCAnbWFzdGVyLnRleCddXG4gICAgICAgIC5tYXAobmFtZSA9PiBwYXRoLmpvaW4oZml4dHVyZXNQYXRoLCBuYW1lKSlcbiAgICAgIGNvbnN0IGluYzJQYXRoID0gcGF0aC5qb2luKGZpeHR1cmVzUGF0aCwgJ2luYzIudGV4JylcbiAgICAgIGNvbnN0IGZpbmRlciA9IG5ldyBNYXN0ZXJUZXhGaW5kZXIoaW5jMlBhdGgpXG4gICAgICBjb25zdCBzb3J0ZWRGaWxlTGlzdCA9IGZpbmRlci5nZXRUZXhGaWxlc0xpc3QoKS5zb3J0KClcblxuICAgICAgZXhwZWN0KHNvcnRlZEZpbGVMaXN0KS50b0VxdWFsKGV4cGVjdGVkRmlsZUxpc3QpXG4gICAgfSlcbiAgfSlcbn0pXG4iXX0=
//# sourceURL=/home/cin_chalic/.atom/packages/latex/spec/master-tex-finder-spec.js
