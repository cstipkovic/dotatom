Object.defineProperty(exports, '__esModule', {
  value: true
});
exports.guessName = guessName;
exports.installPackages = installPackages;
exports.packagesToInstall = packagesToInstall;

var _atom = require('atom');

'use babel';

var extractionRegex = /Installing (.*?) to .* (.*)/;
var nameRegexes = [/[\\\/]packages[\\\/](.*?)[\\\/]/, /[\\\/]([\w-_]+)[\\\/](?:lib|src)[\\\/]/i, /[\\\/]([\w-_]+)[\\\/][\w-_]+\..+$/];

function guessName(filePath) {
  var matches = undefined;

  matches = nameRegexes[0].exec(filePath);
  if (matches) {
    return matches[1];
  }
  matches = nameRegexes[1].exec(filePath);
  if (matches) {
    return matches[1];
  }
  matches = nameRegexes[2].exec(filePath);
  if (matches) {
    return matches[1];
  }
  return null;
}

function installPackages(dependencies, progressCallback) {
  return new Promise(function (resolve, reject) {
    var errors = [];
    new _atom.BufferedProcess({
      command: atom.packages.getApmPath(),
      args: ['install'].concat(dependencies).concat(['--production', '--color', 'false']),
      options: {},
      stdout: function stdout(contents) {
        var matches = extractionRegex.exec(contents);
        atom.packages.activatePackage(matches[1]);
        if (matches[2] === 'âœ“' || matches[2] === 'done') {
          progressCallback(matches[1], true);
        } else {
          progressCallback(matches[1], false);
          errors.push(contents);
        }
      },
      stderr: function stderr(contents) {
        errors.push(contents);
      },
      exit: function exit() {
        if (errors.length) {
          var error = new Error('Error installing dependencies');
          error.stack = errors.join('');
          reject(error);
        } else resolve();
      }
    });
  });
}

function packagesToInstall(name) {
  var packageInfo = atom.packages.getLoadedPackage(name);

  var toInstall = [],
      toEnable = [];
  (packageInfo ? packageInfo.metadata['package-deps'] ? packageInfo.metadata['package-deps'] : [] : []).forEach(function (name) {
    if (!window.__steelbrain_package_deps.has(name)) {
      window.__steelbrain_package_deps.add(name);
      if (atom.packages.resolvePackagePath(name)) {
        toEnable.push(name);
      } else {
        toInstall.push(name);
      }
    }
  });

  return { toInstall: toInstall, toEnable: toEnable };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2Npbl9jaGFsaWMvLmF0b20vcGFja2FnZXMvbGludGVyLWpzY3Mvbm9kZV9tb2R1bGVzL2F0b20tcGFja2FnZS1kZXBzL2xpYi9oZWxwZXJzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7b0JBRThCLE1BQU07O0FBRnBDLFdBQVcsQ0FBQTs7QUFHWCxJQUFNLGVBQWUsR0FBRyw2QkFBNkIsQ0FBQTtBQUNyRCxJQUFNLFdBQVcsR0FBRyxDQUNsQixpQ0FBaUMsRUFDakMseUNBQXlDLEVBQ3pDLG1DQUFtQyxDQUNwQyxDQUFBOztBQUVNLFNBQVMsU0FBUyxDQUFDLFFBQVEsRUFBRTtBQUNsQyxNQUFJLE9BQU8sWUFBQSxDQUFBOztBQUVYLFNBQU8sR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFBO0FBQ3ZDLE1BQUksT0FBTyxFQUFFO0FBQ1gsV0FBTyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUE7R0FDbEI7QUFDRCxTQUFPLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQTtBQUN2QyxNQUFJLE9BQU8sRUFBRTtBQUNYLFdBQU8sT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFBO0dBQ2xCO0FBQ0QsU0FBTyxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUE7QUFDdkMsTUFBSSxPQUFPLEVBQUU7QUFDWCxXQUFPLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQTtHQUNsQjtBQUNELFNBQU8sSUFBSSxDQUFBO0NBQ1o7O0FBRU0sU0FBUyxlQUFlLENBQUMsWUFBWSxFQUFFLGdCQUFnQixFQUFFO0FBQzlELFNBQU8sSUFBSSxPQUFPLENBQUMsVUFBUyxPQUFPLEVBQUUsTUFBTSxFQUFFO0FBQzNDLFFBQU0sTUFBTSxHQUFHLEVBQUUsQ0FBQTtBQUNqQiw4QkFBb0I7QUFDbEIsYUFBTyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxFQUFFO0FBQ25DLFVBQUksRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxjQUFjLEVBQUUsU0FBUyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQ25GLGFBQU8sRUFBRSxFQUFFO0FBQ1gsWUFBTSxFQUFFLGdCQUFTLFFBQVEsRUFBRTtBQUN6QixZQUFNLE9BQU8sR0FBRyxlQUFlLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFBO0FBQzlDLFlBQUksQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO0FBQ3pDLFlBQUksT0FBTyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsSUFBSSxPQUFPLENBQUMsQ0FBQyxDQUFDLEtBQUssTUFBTSxFQUFFO0FBQy9DLDBCQUFnQixDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQTtTQUNuQyxNQUFNO0FBQ0wsMEJBQWdCLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFBO0FBQ25DLGdCQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFBO1NBQ3RCO09BQ0Y7QUFDRCxZQUFNLEVBQUUsZ0JBQVMsUUFBUSxFQUFFO0FBQ3pCLGNBQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUE7T0FDdEI7QUFDRCxVQUFJLEVBQUUsZ0JBQVc7QUFDZixZQUFJLE1BQU0sQ0FBQyxNQUFNLEVBQUU7QUFDakIsY0FBTSxLQUFLLEdBQUcsSUFBSSxLQUFLLENBQUMsK0JBQStCLENBQUMsQ0FBQTtBQUN4RCxlQUFLLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUE7QUFDN0IsZ0JBQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQTtTQUNkLE1BQU0sT0FBTyxFQUFFLENBQUE7T0FDakI7S0FDRixDQUFDLENBQUE7R0FDSCxDQUFDLENBQUE7Q0FDSDs7QUFFTSxTQUFTLGlCQUFpQixDQUFDLElBQUksRUFBRTtBQUN0QyxNQUFJLFdBQVcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFBOztBQUV0RCxNQUFNLFNBQVMsR0FBRyxFQUFFO01BQUUsUUFBUSxHQUFHLEVBQUUsQ0FBQztBQUNwQyxHQUFDLFdBQVcsR0FBSSxXQUFXLENBQUMsUUFBUSxDQUFDLGNBQWMsQ0FBQyxHQUFHLFdBQVcsQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLEdBQUcsRUFBRSxHQUFJLEVBQUUsQ0FBQSxDQUNuRyxPQUFPLENBQUMsVUFBUyxJQUFJLEVBQUU7QUFDdEIsUUFBSSxDQUFDLE1BQU0sQ0FBQyx5QkFBeUIsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUU7QUFDL0MsWUFBTSxDQUFDLHlCQUF5QixDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQTtBQUMxQyxVQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLEVBQUU7QUFDMUMsZ0JBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7T0FDcEIsTUFBTTtBQUNMLGlCQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO09BQ3JCO0tBQ0Y7R0FDRixDQUFDLENBQUE7O0FBRUosU0FBTyxFQUFDLFNBQVMsRUFBVCxTQUFTLEVBQUUsUUFBUSxFQUFSLFFBQVEsRUFBQyxDQUFBO0NBQzdCIiwiZmlsZSI6Ii9ob21lL2Npbl9jaGFsaWMvLmF0b20vcGFja2FnZXMvbGludGVyLWpzY3Mvbm9kZV9tb2R1bGVzL2F0b20tcGFja2FnZS1kZXBzL2xpYi9oZWxwZXJzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBiYWJlbCdcblxuaW1wb3J0IHtCdWZmZXJlZFByb2Nlc3N9IGZyb20gJ2F0b20nXG5jb25zdCBleHRyYWN0aW9uUmVnZXggPSAvSW5zdGFsbGluZyAoLio/KSB0byAuKiAoLiopL1xuY29uc3QgbmFtZVJlZ2V4ZXMgPSBbXG4gIC9bXFxcXFxcL11wYWNrYWdlc1tcXFxcXFwvXSguKj8pW1xcXFxcXC9dLyxcbiAgL1tcXFxcXFwvXShbXFx3LV9dKylbXFxcXFxcL10oPzpsaWJ8c3JjKVtcXFxcXFwvXS9pLFxuICAvW1xcXFxcXC9dKFtcXHctX10rKVtcXFxcXFwvXVtcXHctX10rXFwuLiskL1xuXVxuXG5leHBvcnQgZnVuY3Rpb24gZ3Vlc3NOYW1lKGZpbGVQYXRoKSB7XG4gIGxldCBtYXRjaGVzXG5cbiAgbWF0Y2hlcyA9IG5hbWVSZWdleGVzWzBdLmV4ZWMoZmlsZVBhdGgpXG4gIGlmIChtYXRjaGVzKSB7XG4gICAgcmV0dXJuIG1hdGNoZXNbMV1cbiAgfVxuICBtYXRjaGVzID0gbmFtZVJlZ2V4ZXNbMV0uZXhlYyhmaWxlUGF0aClcbiAgaWYgKG1hdGNoZXMpIHtcbiAgICByZXR1cm4gbWF0Y2hlc1sxXVxuICB9XG4gIG1hdGNoZXMgPSBuYW1lUmVnZXhlc1syXS5leGVjKGZpbGVQYXRoKVxuICBpZiAobWF0Y2hlcykge1xuICAgIHJldHVybiBtYXRjaGVzWzFdXG4gIH1cbiAgcmV0dXJuIG51bGxcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGluc3RhbGxQYWNrYWdlcyhkZXBlbmRlbmNpZXMsIHByb2dyZXNzQ2FsbGJhY2spIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgIGNvbnN0IGVycm9ycyA9IFtdXG4gICAgbmV3IEJ1ZmZlcmVkUHJvY2Vzcyh7XG4gICAgICBjb21tYW5kOiBhdG9tLnBhY2thZ2VzLmdldEFwbVBhdGgoKSxcbiAgICAgIGFyZ3M6IFsnaW5zdGFsbCddLmNvbmNhdChkZXBlbmRlbmNpZXMpLmNvbmNhdChbJy0tcHJvZHVjdGlvbicsICctLWNvbG9yJywgJ2ZhbHNlJ10pLFxuICAgICAgb3B0aW9uczoge30sXG4gICAgICBzdGRvdXQ6IGZ1bmN0aW9uKGNvbnRlbnRzKSB7XG4gICAgICAgIGNvbnN0IG1hdGNoZXMgPSBleHRyYWN0aW9uUmVnZXguZXhlYyhjb250ZW50cylcbiAgICAgICAgYXRvbS5wYWNrYWdlcy5hY3RpdmF0ZVBhY2thZ2UobWF0Y2hlc1sxXSlcbiAgICAgICAgaWYgKG1hdGNoZXNbMl0gPT09ICfinJMnIHx8IG1hdGNoZXNbMl0gPT09ICdkb25lJykge1xuICAgICAgICAgIHByb2dyZXNzQ2FsbGJhY2sobWF0Y2hlc1sxXSwgdHJ1ZSlcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBwcm9ncmVzc0NhbGxiYWNrKG1hdGNoZXNbMV0sIGZhbHNlKVxuICAgICAgICAgIGVycm9ycy5wdXNoKGNvbnRlbnRzKVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgc3RkZXJyOiBmdW5jdGlvbihjb250ZW50cykge1xuICAgICAgICBlcnJvcnMucHVzaChjb250ZW50cylcbiAgICAgIH0sXG4gICAgICBleGl0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKGVycm9ycy5sZW5ndGgpIHtcbiAgICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignRXJyb3IgaW5zdGFsbGluZyBkZXBlbmRlbmNpZXMnKVxuICAgICAgICAgIGVycm9yLnN0YWNrID0gZXJyb3JzLmpvaW4oJycpXG4gICAgICAgICAgcmVqZWN0KGVycm9yKVxuICAgICAgICB9IGVsc2UgcmVzb2x2ZSgpXG4gICAgICB9XG4gICAgfSlcbiAgfSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhY2thZ2VzVG9JbnN0YWxsKG5hbWUpIHtcbiAgbGV0IHBhY2thZ2VJbmZvID0gYXRvbS5wYWNrYWdlcy5nZXRMb2FkZWRQYWNrYWdlKG5hbWUpXG5cbiAgY29uc3QgdG9JbnN0YWxsID0gW10sIHRvRW5hYmxlID0gW107XG4gIChwYWNrYWdlSW5mbyA/IChwYWNrYWdlSW5mby5tZXRhZGF0YVsncGFja2FnZS1kZXBzJ10gPyBwYWNrYWdlSW5mby5tZXRhZGF0YVsncGFja2FnZS1kZXBzJ10gOiBbXSkgOiBbXSlcbiAgICAuZm9yRWFjaChmdW5jdGlvbihuYW1lKSB7XG4gICAgICBpZiAoIXdpbmRvdy5fX3N0ZWVsYnJhaW5fcGFja2FnZV9kZXBzLmhhcyhuYW1lKSkge1xuICAgICAgICB3aW5kb3cuX19zdGVlbGJyYWluX3BhY2thZ2VfZGVwcy5hZGQobmFtZSlcbiAgICAgICAgaWYgKGF0b20ucGFja2FnZXMucmVzb2x2ZVBhY2thZ2VQYXRoKG5hbWUpKSB7XG4gICAgICAgICAgdG9FbmFibGUucHVzaChuYW1lKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRvSW5zdGFsbC5wdXNoKG5hbWUpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuXG4gIHJldHVybiB7dG9JbnN0YWxsLCB0b0VuYWJsZX1cbn1cbiJdfQ==
//# sourceURL=/home/cin_chalic/.atom/packages/linter-jscs/node_modules/atom-package-deps/lib/helpers.js
